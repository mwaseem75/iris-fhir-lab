<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>IRIS FHIR LAB</title>
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport" />
    <link rel="icon" href="resources/img/icon.png" type="image/x-icon" />

    <!-- Fonts and icons -->
    <script src="resources/js/webfont.min.js"></script>
    <script type="text/javascript">
        WebFont.load({
            google: {
                "families": ["Lato:300,400,700,900"]
            },
            custom: {
                "families": ["Flaticon", "Font Awesome 5 Solid", "Font Awesome 5 Regular",
                    "Font Awesome 5 Brands", "simple-line-icons"
                ],
                urls: ['resources/css/fonts.min.css']
            },
            active: function () {
                sessionStorage.fonts = true;
            }
        });
    </script>

    <!-- CSS Files -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link rel="stylesheet" type="text/css" href="resources/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="resources/css/atlantis.min.css">
    <link rel="stylesheet" type="text/css" href="resources/css/adminlte.min.css">
    <link rel="stylesheet" type="text/css" href="resources/css/datatables.min.css">
	<link rel="stylesheet" type="text/css" href="resources/css/buttons.dataTables.min.css">
	<link rel="stylesheet" type="text/css" href="resources/css/jquery.dataTables.min.css">
	<style>
		.bg-info {background-color: #2fa9bd!important}
		.bg-info2 {background-color: #65c8d9!important}
		.bg-warning {background-color: #8dbaf3!important}
		.bg-success {background-color: #3ba954!important}
		.bg-prac {background-color: #f5d060!important}
        .bg-ion {color:#1f2d3d!important}
	</style>

</head>

<body>
    <csp:class encoded=1 super="%CSP.Page,dc.FhirLab.Client">
    <script language="Cache" runat="Server">
    	set patid = $Get(%request.Data("pid",1),0)  
		set patname = $Get(%request.Data("pname",1),0)          
	</script>	
   		
   <div class="container-fluid">
                 <!-- NavBar -->
            <nav class="navbar navbar-header navbar-expand-lg app-bg-color">               
                    <ul class="nav nav-pills">
                       		<li class="nav-item">
							<a class="nav-link" href="/csp/fhirlab/index.csp"><i class="bi bi-house-door"></i> Home</a>
						</li>
							<li class="nav-item">
							<a class="nav-link" href="/csp/fhirlab/resource.csp?resource=Patient"><i class="bi bi-person"></i> Patient Resources</a>
						</li>
							<li class="nav-item">
							<a class="nav-link" href="/csp/fhirlab/create.csp"><i class="bi bi-plus-circle"></i> Create Resource</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="/csp/sys/%25CSP.Portal.Home.zen">Management Portal</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="/csp/healthshare/fhirserver/EnsPortal.ProductionConfig.zen?$NAMESPACE=FHIRSERVER&$NAMESPACE=FHIRSERVER&">Production</a>
						</li>						
						<li class="nav-item">
							<a class="nav-link" href="https://www.hl7.org/fhir/">FHIR Official website</a>
						</li>						
                    </ul>                              
            </nav>
            <!-- End Navbar -->
                    
                          <!-- Widget: user widget style 2 -->
                        <div class="card card-widget widget-user-2">
                            <!-- Add the bg color to the header using any of the bg-* classes -->
                            <div class="widget-user-header bg-warning">
                                <div class="row">
                                    <div class="col-md-1" style="text-align:right;">
				                	<i style="font-size: 5em;" class="ion ion-person bg-ion"></i>
				                    </div>
                                    <div class="col-md-8">
                                        <!-- /.widget-user-image -->
                                        <h3  style="margin-left: 0" class="widget-user-username bg-ion ">
                                           
                                        </h3>
                                        <h5  style="margin-left: 0" class="widget-user-desc bg-ion"></h5>
                                    </div>
                                </div>
                           
                        </div>
     
            <div class="row">
                <div class="col-lg-4 col-4">
                    <!-- Customized Card -->
                    <div class="card">                      
                        <!-- /.card-header -->
                            <div class="card-header">                         
                                 
                            <!-- Widget: user widget style 2 -->
                            <div class="card card-widget widget-user-2">
                                <!-- Add the bg color to the header using any of the bg-* classes -->
                                <div class="widget-user-header bg-info">
                                    
                                    <!-- /.widget-user-image -->
                                    <h3 class="widget-user-username">Patient Resources</h3>

                                </div>
                                <div class="card-footer p-0">
                                    <ul class="nav flex-column">
                                        
                                        <li class="nav-item">
                                        
                                            <a  href="#" class="nav-link">
                                                Observations <span class="float-right badge bg-primary"><h6>obsr</h6></span>
                                            </a>
                                       </li>                                                                                                    
                                    </ul>
                                </div>                      
                            </div>
                        </div>
                        <!-- /.table-responsive -->
                    </div>                  
                </div>
				   <div class="col-lg-8 col-8">
                    <!-- Customized Card -->
                    <div class="card">                      
                        <!-- /.card-header -->
                            <div class="card-header">                         
                                 
                                        <!-- Widget: user widget style 2 -->
                                        <div class="card card-widget widget-user-2">
                                            <!-- Add the bg color to the header using any of the bg-* classes -->
                                            <div class="widget-user-header bg-info">
                                               
                                                <!-- /.widget-user-image -->
                                                <h3 class="widget-user-username">Patient Observations</h3>

                                            </div>
											  <script language="Cache" runat="Server">
										
									    Set ColNames = ..GetHeaderRow(3)
                                </script>                  
                                            <div class="card-footer p-0">
                                               <div class="table-responsive">
                                <table id="observation-data" class="display table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            #(ColNames)#
                                        </tr>
                                    </thead>
                                    <tbody>
                                       
                                       <form>
										<h2> Select An O2 Saturation Level</h2>

										<label for="points">Points (between 80% and 100%): </label>
										<input type="range" id="myRange" name="points" min="80" max="100">
										<br>
										<p>Value <span id="output"></span>%</p>
										<br>
										<br>
										<br>
										<br>
										<label for="username" > Username: </label>
										<br>
										<input type="text" value="superuser" id="username">
										<br>
										<label for="password"> Password: </label>
										<br>
										<input type="text" id="password" value="SYS">
										<br>
										<br>
										<label for="serverDetails"> Server Details (if you are using a docker container enter "[ip address]:[webserver port]"): </label>
										<br>
										<input type="text" style="width:400px" value = "localhost:52773" placeholder="enter server details. For learning labs, use 'Atelier Server Address'" id="host">

										<br>
										<label for="basepath" > Base FHIR Path</label>
										<br>
										<input type="text" style="width:400px" value="/csp/healthshare/fhirser/fhir/r4/Observation" id="basepath">
										<br>
										<input type="checkbox" id="ssl">Send over TLS (uncheck this if you are using a docker container)</input>
										<br>
										<br>
										<button type="button" id="sendButton" onclick="sendToServer()">Send</button>
										<br>
										<br>

										</form>

                                       
                                       	
                                    </tbody>
                                </table>
                            </div>
                                            </div>                      
                            </div>
                        </div>
                        <!-- /.table-responsive -->
                    </div>                  
                </div>
            
                <!-- /.card -->
            </div>
            <!-- /.col -->
            <!-- PRODUCT LIST -->

        </div>
    
        <footer class="footer">
            <div class="container-fluid">
                <nav class="pull-left">
                    <ul class="nav">
                        <li class="nav-item">

                            2022, IRIS FHIR Client

                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">

                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">

                            </a>
                        </li>
                    </ul>
                </nav>

            </div>
        </footer>
        </div>
        </div>

        </div>
        </div>
        <!--   Core JS Files   -->
        <script src="resources/js/jquery.min.js"></script>
		<script src="resources/js/jquery-ui.min.js"></script>
		
		<script src="resources/js/popper.min.js"></script>
        <script src="resources/js/bootstrap.min.js"></script>
        <!-- jQuery UI -->
        
        <script src="resources/js/jquery.ui.touch-punch.min.js"></script>
        <!-- jQuery Scrollbar -->
        <script src="resources/js/jquery.scrollbar.min.js"></script>
        <!-- Atlantis JS -->
        <script src="resources/js/atlantis.min.js"></script>
		<!-- Script Files -->
		
		<script src="resources/js/datatables.min.js"></script>
		<script src="resources/js/dataTables.buttons.min.js"></script>
		<script src="resources/js/jszip.min.js"></script>
		<script src="resources/js/pdfmake.min.js"></script>
		<script src="resources/js/vfs_fonts.js"></script>
		<script src="resources/js/buttons.html5.min.js"></script>
		
        
		<script type="text/javascript">

            $(document).ready(function () {               
                $('#observation-data').DataTable({
                    dom: 'Bfrtip',
                    buttons: [
                        'copyHtml5',
                        'excelHtml5',
                        'csvHtml5',
                        'pdfHtml5'
                    ]
                });
            });

        </script>
        <script>
    var slider = document.getElementById("myRange");
    var output = document.getElementById("output");
    output.innerHTML = slider.value; // Display the default slider value

    // Update the current slider value (each time you drag the slider handle)
    slider.oninput = function() {
        output.innerHTML = this.value;
    }
    
    function sendToServer(){

        var slider = document.getElementById("myRange");
        var value = parseInt(slider.value)
        var host = document.getElementById("host").value
        var path = document.getElementById("basepath").value
        var username = document.getElementById("username").value
        var password = document.getElementById("password").value
        var a64 = btoa(`${username}:${password}`)
        var ssl = document.getElementById("ssl").checked
        var prot = "http"
        if (ssl) {
            prot = "https"
            
        }

        var url = `${prot}://${host}${path}`
        payload.valueQuantity.value = value
        fetch(url, {
            method: "POST",
            headers:{
            "Content-Type": "application/fhir+json;charset=utf-8",
            "Accept":"application/fhir+json",
            "Authorization" : `Basic ${a64}`
            },
            "body": JSON.stringify(payload)
        }).then((Response)=> {
            if (Response.status == 201) {
                alert("Your FHIR Resource arrived successfully. Reponse Status: " + Response.status)
            }
            else {
                alert("Something went wrong. Reponse Status: " + Response.status)
            }
        }).catch((e)=>{
            alert("Something went wrong: " + e)
        })
    }
    var payload ={
            "resourceType": "Observation",
            "meta": {
                "profile": [
                "http://hl7.org/fhir/StructureDefinition/vitalsigns"
                ]
            },
            "text": {
                "status": "generated",
                "div": "<div xmlns=\"http://www.w3.org/1999/xhtml\"><p><b>Generated Narrative with Details</b></p><p><b>id</b>: satO2</p><p><b>meta</b>: </p><p><b>identifier</b>: o1223435-10</p><p><b>partOf</b>: <a>Procedure/ob</a></p><p><b>status</b>: final</p><p><b>category</b>: Vital Signs <span>(Details : {http://terminology.hl7.org/CodeSystem/observation-category code 'vital-signs' = 'Vital Signs', given as 'Vital Signs'})</span></p><p><b>code</b>: Oxygen saturation in Arterial blood <span>(Details : {LOINC code '2708-6' = 'Oxygen saturation in Arterial blood', given as 'Oxygen saturation in Arterial blood'}; {LOINC code '59408-5' = 'Oxygen saturation in Arterial blood by Pulse oximetry', given as 'Oxygen saturation in Arterial blood by Pulse oximetry'}; {urn:iso:std:iso:11073:10101 code '150456' = '150456', given as 'MDC_PULS_OXIM_SAT_O2'})</span></p><p><b>subject</b>: <a>Patient/example</a></p><p><b>effective</b>: 05/12/2014 9:30:10 AM</p><p><b>value</b>: 95 %<span> (Details: UCUM code % = '%')</span></p><p><b>interpretation</b>: Normal (applies to non-numeric results) <span>(Details : {http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation code 'N' = 'Normal', given as 'Normal'})</span></p><p><b>device</b>: <a>DeviceMetric/example</a></p><h3>ReferenceRanges</h3><table><tr><td>-</td><td><b>Low</b></td><td><b>High</b></td></tr><tr><td>*</td><td>90 %<span> (Details: UCUM code % = '%')</span></td><td>99 %<span> (Details: UCUM code % = '%')</span></td></tr></table></div>"
            },
            "identifier": [
                {
                "system": "http://goodcare.org/observation/id",
                "value": "o1223435-10"
                }
            ],
            "partOf": [
                {
                "reference": "Procedure/ob"
                }
            ],
            "status": "final",
            "category": [
                {
                "coding": [
                    {
                    "system": "http://terminology.hl7.org/CodeSystem/observation-category",
                    "code": "vital-signs",
                    "display": "Vital Signs"
                    }
                ],
                "text": "Vital Signs"
                }
            ],
            "code": {
                "coding": [
                {
                    "system": "http://loinc.org",
                    "code": "2708-6",
                    "display": "Oxygen saturation in Arterial blood"
                },
                {
                    "system": "http://loinc.org",
                    "code": "59408-5",
                    "display": "Oxygen saturation in Arterial blood by Pulse oximetry"
                },
                {
                    "system": "urn:iso:std:iso:11073:10101",
                    "code": "150456",
                    "display": "MDC_PULS_OXIM_SAT_O2"
                }
                ]
            },
            "subject": {
                "reference": "Patient/52"
            },
            "effectiveDateTime": "2014-12-05T09:30:10+01:00",
            "valueQuantity": {
                "value": "100",
                "unit": "%",
                "system": "http://unitsofmeasure.org",
                "code": "%"
            },
            "interpretation": [
                {
                "coding": [
                    {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                    "code": "N",
                    "display": "Normal"
                    }
                ],
                "text": "Normal (applies to non-numeric results)"
                }
            ],
            "device": {
                "reference": "DeviceMetric/example"
            },
            "referenceRange": [
                {
                "low": {
                    "value": 90,
                    "unit": "%",
                    "system": "http://unitsofmeasure.org",
                    "code": "%"
                },
                "high": {
                    "value": 99,
                    "unit": "%",
                    "system": "http://unitsofmeasure.org",
                    "code": "%"
                }
                }
            ]
            }

</script>

</body>


</html>
